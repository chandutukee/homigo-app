import te,{useState as oe}from"react";import re from"next/image";import{getTransformations as ne}from"@cloudinary-util/util";import{transformationPlugins as ie}from"@cloudinary-util/url-loader";async function V(e){let{src:a}=e;try{await new Promise((i,r)=>{fetch(a).then(t=>{if(!t.ok){r(t);return}i(t)})})}catch(i){return i.status===423?await V(e):!1}return!0}import{constructCloudinaryUrl as ee}from"@cloudinary-util/url-loader";import Z from"next/package.json";var j={name:"next-cloudinary",version:"4.1.1",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.0.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var L="V",_=j.version,x=Z.version;function k({loaderOptions:e,imageProps:a,cldOptions:i,cldConfig:r={}}){let t={...a,...i};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let s=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*s))}return ee({options:t,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME},...r},analytics:{sdkCode:L,sdkSemver:_,techVersion:x,feature:""}})}var de=e=>{let a=["deliveryType","preserveTransformations"];ie.forEach(({props:o=[]})=>{o.forEach(n=>{if(a.includes(n))throw new Error(`Option ${n} already exists!`);a.push(n)})});let i={alt:e.alt,src:e.src};Object.keys(e).filter(o=>!a.includes(o)).forEach(o=>i[o]=e[o]);let r=Object.keys(i).map(o=>`${o}:${i[o]}`).join(";"),[t,s]=oe(r),d={};if(a.forEach(o=>{e[o]&&(d[o]=e[o]||void 0)}),e.preserveTransformations)try{let o=ne(e.src);d.rawTransformations=[...o.flat(),...e.rawTransformations||[]]}catch(o){console.warn(`Failed to preserve transformations: ${o.message}`)}async function l(o){await V({src:o.target.src})&&s(`${r};${Date.now()}`)}return te.createElement(re,{key:t,...i,loader:o=>k({loaderOptions:o,imageProps:i,cldOptions:d}),onError:l})},M=de;import f from"react";import ae from"next/head";import{constructCloudinaryUrl as le}from"@cloudinary-util/url-loader";var se=2400,pe=1200,ce="summary_large_image",ue=({excludeTags:e=[],twitterTitle:a,keys:i={},...r})=>{let{alt:t}=r,s={...r,crop:r.crop||"fill",gravity:r.gravity||"center",height:r.height||pe,src:r.src,width:r.width||se},d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...i},l=le({options:s,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},analytics:{sdkCode:L,sdkSemver:_,techVersion:x,feature:""}});return f.createElement(ae,null,f.createElement("meta",{key:d["og:image"],property:"og:image",content:l}),f.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:l}),f.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${s.width}`}),f.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${s.height}`}),t&&f.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&f.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:a||" "}),f.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:ce}),f.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:l}))},X=ue;import v from"react";import W,{useState as $,useEffect as B,useRef as H}from"react";import me from"next/script";function Y(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var fe=["success","display-changed"],ge=({children:e,onClose:a,onError:i,onOpen:r,onUpload:t,options:s,signatureEndpoint:d,uploadPreset:l})=>{let o=H(),n=H(),C=!!d,[h,b]=$(void 0),[m,T]=$(void 0),P={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:l||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...s};C&&(P.uploadSignature=w,P.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),B(()=>{if(typeof m=="undefined")return;let p=m.event==="success",c=m.event==="display-changed"&&m.info==="hidden";p&&typeof t=="function"&&t(m,n.current),c&&typeof a=="function"&&a(n.current)},[m]),B(()=>{h&&typeof i=="function"&&i(h,n.current)},[h]);function O(){o.current||(o.current=window.cloudinary),Y(()=>{n.current||(n.current=E())})}function w(p,c){if(typeof d=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(d,{method:"POST",body:JSON.stringify({paramsToSign:c})}).then(u=>u.json()).then(({signature:u})=>{p(u)})}function E(){var p;return(p=o.current)==null?void 0:p.createUploadWidget(P,(c,u)=>{typeof c!="undefined"&&b(c),fe.includes(u==null?void 0:u.event)&&T(u)})}function U(){n.current||(n.current=E()),n==null||n.current.open(),typeof r=="function"&&r(n.current)}return W.createElement(W.Fragment,null,typeof e=="function"&&e({cloudinary:o.current,widget:n.current,open:U,results:m,error:h}),W.createElement(me,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:O,onError:p=>console.error(`Failed to load Cloudinary Upload Widget: ${p.message}`)}))},N=ge;var ye=({children:e,onClick:a,onError:i,onUpload:r,options:t,signatureEndpoint:s,uploadPreset:d,...l})=>v.createElement(v.Fragment,null,v.createElement(N,{onError:i,onUpload:r,options:t,signatureEndpoint:s,uploadPreset:d},({open:o})=>{function n(C){C.preventDefault(),o(),typeof a=="function"&&a(C)}return v.createElement("button",{...l,onClick:n},e||"Upload")})),F=ye;import y,{useRef as S}from"react";import Ce from"next/script";import he from"next/head";var Pe=e=>{let{autoPlay:a="never",colors:i,controls:r=!0,fontFace:t,height:s,id:d,logo:l=!0,loop:o=!1,muted:n=!1,onDataLoad:C,onError:h,onMetadataLoad:b,onPause:m,onPlay:T,onEnded:P,src:O,version:w="1.9.4",width:E}=e,U=S(),p=S(),c=e.videoRef||p,u=S(),A=e.playerRef||u,z=d||`player-${O.replace("/","-")}`,D={error:h,loadeddata:C,loadedmetadata:b,pause:m,play:T,ended:P};function G(g){let I=D[g.type];typeof I=="function"&&I(J())}function q(){if("cloudinary"in window){U.current=window.cloudinary;let g={};typeof l=="boolean"?g.showLogo=l:typeof l=="object"&&(g={...g,showLogo:!0,logoImageUrl:l.imageUrl,logoOnclickUrl:l.onClickUrl}),A.current=U.current.videoPlayer(c.current,{autoplayMode:a,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,color:i,controls:r,fontFace:t||"",loop:o,muted:n,publicId:O,secure:!0,...g}),Object.keys(D).forEach(I=>{var R;typeof D[I]=="function"&&((R=A.current)==null||R.on(I,G))})}}function J(){return{player:A.current,video:c.current}}return y.createElement(y.Fragment,null,y.createElement(he,null,y.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.css`,rel:"stylesheet"})),y.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},y.createElement("video",{ref:c,id:z,className:"cld-video-player cld-fluid",width:E,height:s}),y.createElement(Ce,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.js`,onLoad:q,onError:g=>console.error(`Failed to load Cloudinary Video Player: ${g.message}`)})))},K=Pe;export{M as CldImage,X as CldOgImage,F as CldUploadButton,N as CldUploadWidget,K as CldVideoPlayer,k as cloudinaryLoader};
//# sourceMappingURL=index.mjs.map