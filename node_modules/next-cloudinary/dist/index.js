"use strict";var le=Object.create;var v=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var me=(e,o)=>{for(var n in o)v(e,n,{get:o[n],enumerable:!0})},H=(e,o,n,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of pe(o))!ue.call(e,t)&&t!==n&&v(e,t,{get:()=>o[t],enumerable:!(i=se(o,t))||i.enumerable});return e};var u=(e,o,n)=>(n=e!=null?le(ce(e)):{},H(o||!e||!e.__esModule?v(n,"default",{value:e,enumerable:!0}):n,e)),fe=e=>H(v({},"__esModule",{value:!0}),e);var Le={};me(Le,{CldImage:()=>M,CldOgImage:()=>X,CldUploadButton:()=>Y,CldUploadWidget:()=>E,CldVideoPlayer:()=>$,cloudinaryLoader:()=>D});module.exports=fe(Le);var V=u(require("react")),G=u(require("next/image")),q=require("@cloudinary-util/util"),J=require("@cloudinary-util/url-loader");async function j(e){let{src:o}=e;try{await new Promise((n,i)=>{fetch(o).then(t=>{if(!t.ok){i(t);return}n(t)})})}catch(n){return n.status===423?await j(e):!1}return!0}var z=require("@cloudinary-util/url-loader");var K=u(require("next/package.json"));var F={name:"next-cloudinary",version:"4.1.1",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.0.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var b="V",T=F.version,A=K.default.version;function D({loaderOptions:e,imageProps:o,cldOptions:n,cldConfig:i={}}){let t={...o,...n};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let s=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*s))}return(0,z.constructCloudinaryUrl)({options:t,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME},...i},analytics:{sdkCode:b,sdkSemver:T,techVersion:A,feature:""}})}var ye=e=>{let o=["deliveryType","preserveTransformations"];J.transformationPlugins.forEach(({props:r=[]})=>{r.forEach(d=>{if(o.includes(d))throw new Error(`Option ${d} already exists!`);o.push(d)})});let n={alt:e.alt,src:e.src};Object.keys(e).filter(r=>!o.includes(r)).forEach(r=>n[r]=e[r]);let i=Object.keys(n).map(r=>`${r}:${n[r]}`).join(";"),[t,s]=(0,V.useState)(i),a={};if(o.forEach(r=>{e[r]&&(a[r]=e[r]||void 0)}),e.preserveTransformations)try{let r=(0,q.getTransformations)(e.src);a.rawTransformations=[...r.flat(),...e.rawTransformations||[]]}catch(r){console.warn(`Failed to preserve transformations: ${r.message}`)}async function l(r){await j({src:r.target.src})&&s(`${i};${Date.now()}`)}return V.default.createElement(G.default,{key:t,...n,loader:r=>D({loaderOptions:r,imageProps:n,cldOptions:a}),onError:l})},M=ye;var y=u(require("react")),Q=u(require("next/head")),Z=require("@cloudinary-util/url-loader");var Ce=2400,he=1200,Pe="summary_large_image",Ie=({excludeTags:e=[],twitterTitle:o,keys:n={},...i})=>{let{alt:t}=i,s={...i,crop:i.crop||"fill",gravity:i.gravity||"center",height:i.height||he,src:i.src,width:i.width||Ce},a={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n},l=(0,Z.constructCloudinaryUrl)({options:s,config:{cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},analytics:{sdkCode:b,sdkSemver:T,techVersion:A,feature:""}});return y.default.createElement(Q.default,null,y.default.createElement("meta",{key:a["og:image"],property:"og:image",content:l}),y.default.createElement("meta",{key:a["og:image:secure_url"],property:"og:image:secure_url",content:l}),y.default.createElement("meta",{key:a["og:image:width"],property:"og:image:width",content:`${s.width}`}),y.default.createElement("meta",{key:a["og:image:height"],property:"og:image:height",content:`${s.height}`}),t&&y.default.createElement("meta",{key:a["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&y.default.createElement("meta",{key:a["twitter:title"],property:"twitter:title",content:o||" "}),y.default.createElement("meta",{key:a["twitter:card"],property:"twitter:card",content:Pe}),y.default.createElement("meta",{key:a["twitter:image"],property:"twitter:image",content:l}))},X=Ie;var U=u(require("react"));var p=u(require("react")),te=u(require("next/script"));function ee(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Oe=["success","display-changed"],we=({children:e,onClose:o,onError:n,onOpen:i,onUpload:t,options:s,signatureEndpoint:a,uploadPreset:l})=>{let r=(0,p.useRef)(),d=(0,p.useRef)(),P=!!a,[I,k]=(0,p.useState)(void 0),[C,W]=(0,p.useState)(void 0),O={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:l||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...s};P&&(O.uploadSignature=_,O.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,p.useEffect)(()=>{if(typeof C=="undefined")return;let m=C.event==="success",f=C.event==="display-changed"&&C.info==="hidden";m&&typeof t=="function"&&t(C,d.current),f&&typeof o=="function"&&o(d.current)},[C]),(0,p.useEffect)(()=>{I&&typeof n=="function"&&n(I,d.current)},[I]);function L(){r.current||(r.current=window.cloudinary),ee(()=>{d.current||(d.current=x())})}function _(m,f){if(typeof a=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(a,{method:"POST",body:JSON.stringify({paramsToSign:f})}).then(g=>g.json()).then(({signature:g})=>{m(g)})}function x(){var m;return(m=r.current)==null?void 0:m.createUploadWidget(O,(f,g)=>{typeof f!="undefined"&&k(f),Oe.includes(g==null?void 0:g.event)&&W(g)})}function N(){d.current||(d.current=x()),d==null||d.current.open(),typeof i=="function"&&i(d.current)}return p.default.createElement(p.default.Fragment,null,typeof e=="function"&&e({cloudinary:r.current,widget:d.current,open:N,results:C,error:I}),p.default.createElement(te.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:L,onError:m=>console.error(`Failed to load Cloudinary Upload Widget: ${m.message}`)}))},E=we;var Ee=({children:e,onClick:o,onError:n,onUpload:i,options:t,signatureEndpoint:s,uploadPreset:a,...l})=>U.default.createElement(U.default.Fragment,null,U.default.createElement(E,{onError:n,onUpload:i,options:t,signatureEndpoint:s,uploadPreset:a},({open:r})=>{function d(P){P.preventDefault(),r(),typeof o=="function"&&o(P)}return U.default.createElement("button",{...l,onClick:d},e||"Upload")})),Y=Ee;var c=u(require("react")),oe=u(require("next/script")),re=u(require("next/head")),Ue=e=>{let{autoPlay:o="never",colors:n,controls:i=!0,fontFace:t,height:s,id:a,logo:l=!0,loop:r=!1,muted:d=!1,onDataLoad:P,onError:I,onMetadataLoad:k,onPause:C,onPlay:W,onEnded:O,src:L,version:_="1.9.4",width:x}=e,N=(0,c.useRef)(),m=(0,c.useRef)(),f=e.videoRef||m,g=(0,c.useRef)(),S=e.playerRef||g,ne=a||`player-${L.replace("/","-")}`,R={error:I,loadeddata:P,loadedmetadata:k,pause:C,play:W,ended:O};function ie(h){let w=R[h.type];typeof w=="function"&&w(ae())}function de(){if("cloudinary"in window){N.current=window.cloudinary;let h={};typeof l=="boolean"?h.showLogo=l:typeof l=="object"&&(h={...h,showLogo:!0,logoImageUrl:l.imageUrl,logoOnclickUrl:l.onClickUrl}),S.current=N.current.videoPlayer(f.current,{autoplayMode:o,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,color:n,controls:i,fontFace:t||"",loop:r,muted:d,publicId:L,secure:!0,...h}),Object.keys(R).forEach(w=>{var B;typeof R[w]=="function"&&((B=S.current)==null||B.on(w,ie))})}}function ae(){return{player:S.current,video:f.current}}return c.default.createElement(c.default.Fragment,null,c.default.createElement(re.default,null,c.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${_}/dist/cld-video-player.min.css`,rel:"stylesheet"})),c.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},c.default.createElement("video",{ref:f,id:ne,className:"cld-video-player cld-fluid",width:x,height:s}),c.default.createElement(oe.default,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${_}/dist/cld-video-player.min.js`,onLoad:de,onError:h=>console.error(`Failed to load Cloudinary Video Player: ${h.message}`)})))},$=Ue;0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader});
//# sourceMappingURL=index.js.map